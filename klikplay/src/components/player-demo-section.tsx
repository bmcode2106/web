"use client"

import React, { useState, useMemo } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Input } from "@/components/ui/input";
import { Switch } from "@/components/ui/switch";
import { Button } from '@/components/ui/button';
import { Copy, Check } from 'lucide-react';

export function PlayerDemoSection() {
  // === STATE INITIALIZATION ===
    const [mediaType, setMediaType] = useState("movie");
      const [movieTmdbId, setMovieTmdbId] = useState("597");
        const [tvTmdbId, setTvTmdbId] = useState("1399");
          const [season, setSeason] = useState("1");
            const [episode, setEpisode] = useState("1");
              const [animeId, setAnimeId] = useState("21");
                const [animeEpisode, setAnimeEpisode] = useState("1");
                  const [isDubbed, setIsDubbed] = useState(false);
                    const [isCopied, setIsCopied] = useState(false);

                      // === DYNAMIC URL GENERATION (OPTIMIZED) ===
                        const embedUrl = useMemo(() => {
                            const baseUrl = "https://relatein.web.id/embed"; // Your domain here
                                switch (mediaType) {
                                      case 'tv':
                                              return `${baseUrl}/tv/${tvTmdbId || '1399'}/${season || '1'}/${episode || '1'}`;
                                                    case 'anime':
                                                            return `${baseUrl}/anime/${animeId || '21'}/${animeEpisode || '1'}?dub=${isDubbed}`;
                                                                  case 'movie':
                                                                        default:
                                                                                return `${baseUrl}/movie/${movieTmdbId || '597'}`;
                                                                                    }
                                                                                      }, [mediaType, movieTmdbId, tvTmdbId, season, episode, animeId, animeEpisode, isDubbed]);

                                                                                        // === EVENT HANDLERS ===
                                                                                          const handleCopy = () => {
                                                                                              navigator.clipboard.writeText(embedUrl);
                                                                                                  setIsCopied(true);
                                                                                                      setTimeout(() => setIsCopied(false), 2000); // Reset after 2 seconds
                                                                                                        };

                                                                                                          return (
                                                                                                              <section id="player" className="py-24 sm:py-32">
                                                                                                                    <div className="container px-4">
                                                                                                                            {/* Section Header */}
                                                                                                                                    <div className="mx-auto max-w-2xl text-center">
                                                                                                                                              <h2 className="text-3xl font-bold tracking-tight md:text-4xl">
                                                                                                                                                          Advanced <span className="bg-gradient-to-r from-primary via-purple-500 to-pink-500 bg-clip-text text-transparent">Player</span> Demo
                                                                                                                                                                    </h2>
                                                                                                                                                                              <p className="mt-4 text-lg text-muted-foreground">
                                                                                                                                                                                          Our powerful custom player allows you to tailor your viewing experience exactly how you want it.
                                                                                                                                                                                                    </p>
                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                    {/* Player Demo UI Grid */}
                                                                                                                                                                                                                            <div className="mx-auto mt-16 grid max-w-6xl grid-cols-1 gap-8 lg:grid-cols-5">
                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                {/* Left Side: Player Preview */}
                                                                                                                                                                                                                                                          <div className="lg:col-span-3">
                                                                                                                                                                                                                                                                      <div className="space-y-4">
                                                                                                                                                                                                                                                                                    <div className="aspect-video w-full overflow-hidden rounded-lg border bg-muted">
                                                                                                                                                                                                                                                                                                    <iframe
                                                                                                                                                                                                                                                                                                                      key={embedUrl} // CRITICAL: Forces re-render on URL change
                                                                                                                                                                                                                                                                                                                                        src={embedUrl}
                                                                                                                                                                                                                                                                                                                                                          title="KlikPlay Embedded Player"
                                                                                                                                                                                                                                                                                                                                                                            allowFullScreen
                                                                                                                                                                                                                                                                                                                                                                                              allow="autoplay; encrypted-media"
                                                                                                                                                                                                                                                                                                                                                                                                                className="h-full w-full"
                                                                                                                                                                                                                                                                                                                                                                                                                                />
                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="rounded-lg border bg-card p-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="flex items-center justify-between gap-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <code className="truncate text-sm text-muted-foreground">{embedUrl}</code>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <Button size="icon" variant="ghost" onClick={handleCopy}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {isCopied ? <Check className="h-4 w-4 text-green-500" /> : <Copy className="h-4 w-4" />}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </Button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* Right Side: Controls */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div className="lg:col-span-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div className="rounded-lg border bg-card p-4 shadow-sm">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Tabs value={mediaType} onValueChange={setMediaType} className="w-full">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <TabsList className="grid w-full grid-cols-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <TabsTrigger value="movie">Movie</TabsTrigger>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <TabsTrigger value="tv">Series</TabsTrigger>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <TabsTrigger value="anime">Anime</TabsTrigger>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </TabsList>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <TabsContent value="movie">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="mt-4 space-y-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <label htmlFor="tmdbIdMovie" className="text-sm font-medium">TMDB Movie ID</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Input id="tmdbIdMovie" type="text" placeholder="e.g., 597" value={movieTmdbId} onChange={(e) => setMovieTmdbId(e.target.value)} className="text-center font-mono"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </TabsContent>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <TabsContent value="tv">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="mt-4 space-y-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <label htmlFor="tmdbIdTv" className="mb-2 block text-sm font-medium">TMDB Series ID</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <Input id="tmdbIdTv" type="text" placeholder="e.g., 1399" value={tvTmdbId} onChange={(e) => setTvTmdbId(e.target.value)} className="text-center font-mono"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="grid grid-cols-2 gap-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <label htmlFor="season" className="mb-2 block text-sm font-medium">Season</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <Input id="season" type="number" placeholder="e.g., 1" value={season} onChange={(e) => setSeason(e.target.value)} className="text-center font-mono" min="1"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label htmlFor="episode" className="mb-2 block text-sm font-medium">Episode</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <Input id="episode" type="number" placeholder="e.g., 1" value={episode} onChange={(e) => setEpisode(e.target.value)} className="text-center font-mono" min="1"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </TabsContent>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <TabsContent value="anime">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="mt-4 space-y-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="grid grid-cols-2 gap-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <label htmlFor="animeId" className="mb-2 block text-sm font-medium">Anilist ID</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <Input id="animeId" type="text" placeholder="e.g., 21" value={animeId} onChange={(e) => setAnimeId(e.target.value)} className="text-center font-mono"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <label htmlFor="animeEpisode" className="mb-2 block text-sm font-medium">Episode</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <Input id="animeEpisode" type="number" placeholder="e.g., 1" value={animeEpisode} onChange={(e) => setAnimeEpisode(e.target.value)} className="text-center font-mono" min="1"/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="flex items-center justify-center space-x-2 rounded-md border p-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label htmlFor="dub-switch" className="text-sm font-medium">Dubbed Version</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <Switch id="dub-switch" checked={isDubbed} onCheckedChange={setIsDubbed}/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </TabsContent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </Tabs>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </section>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }